function init_list_events(a,b,c,d){$("#"+a+"_list").find("#search_box").keyup(function(b){search_timer&&clearTimeout(search_timer),search_timer=setTimeout(function(){search(a,$("#"+a+"_list").find("#search_box").val(),c,d)},750)}),$("#"+a+"_list").find(".list_header_item").click(function(){$(this).hasClass("not_sortable")||(item_sort=$(this).attr("id"),sort_way=$(this).attr("value"),sort_way=="desc"?new_sort="asc":new_sort="desc",$(this).attr("value",new_sort),$("#"+a+"_list").find(".item_header_sort").html(""),$(this).find(".item_header_sort").html(order_pic[sort_way]),sort_items_list(a,new_sort,item_sort,!1))}),$("#"+a+"_massive_delete").click(function(){items=[],$("#"+a+"_list").find(".row").each(function(){$(this).find("."+a+"_checkbox").is(":checked")==1&&items.push($(this).find("."+a+"_"+b).text())}),html="<ul>",$.each(items,function(a,b){html+="<li>"+b+"</li>"}),html+="</ul>",delete_title=gettext("Massive removal"),html=="<ul></ul>"?(delete_content=gettext("Please select at least one account."),delete_dialog=new dialog(delete_title,delete_content)):(delete_content=gettext("Are you sure you want to remove these account(s):"),delete_content+=html,delete_content+="<input type='checkbox' id='massive_delete_no_archive'/> <label for='massive_delete_no_archive'>"+gettext("Definitely remove account data (no archiving)")+"</label>",delete_dialog=new dialog(delete_title,delete_content,!0,function(){items=[],$("#"+a+"_list").find(".row").each(function(){$(this).find("."+a+"_checkbox").is(":checked")==1&&(items.push($(this).find("."+a+"_"+d).text()),clear_sub_content_with_id($(this).find("."+a+"_"+d).text()))}),$("#massive_delete_no_archive").attr("checked")?no_archive="True":no_archive="",page_url="/"+a+"/massive/delete/"+$.URLEncode(items.join(","))+"/"+no_archive,$.get(page_url)})),delete_dialog.show()}),$("#"+a+"_massive_export").click(function(){items=[],$("#"+a+"_list").find(".row").each(function(){$(this).find("."+a+"_checkbox").is(":checked")==1&&items.push($.trim($(this).find("."+a+"_"+b).text()))}),html="<ul>",$.each(items,function(a,b){html+="<li>"+b+"</li>"}),html+="</ul>",export_title=gettext("Massive export"),html=="<ul></ul>"?(export_content=gettext("Please select at least one account."),export_dialog=new dialog(export_title,export_content)):(export_content=gettext("Are you sure you want to export these account(s):"),export_content+=html,export_content+="<br />",export_content+=gettext("Please choose the export format : "),export_content+='<select id="id_export_type">',export_content+='<option name="csv">CSV</option>',export_content+='<option name="XML">XML</option>',export_content+="</select>",export_content+='<iframe id="download_iframe" style="display:none"></iframe>',export_dialog=new dialog(export_title,export_content,!0,function(){items=[],$("#"+a+"_list").find(".row").each(function(){$(this).find("."+a+"_checkbox").is(":checked")==1&&(items.push($(this).find("."+a+"_"+d).text()),clear_sub_content_with_id($(this).find("."+a+"_"+d).text()))}),type=$("#id_export_type").val().toString(),page_url="/"+a+"/massive/export/"+$.URLEncode(items.join(","))+"/"+type,$.get(page_url,function(a){file_name=a.file_name,preview=a.preview,iframe=document.getElementById("download_iframe"),iframe.src="/system/download/"+file_name},"json")})),export_dialog.show()}),$("#"+a+"_massive_skel").click(function(){users=[],$("#"+a+"_list").find(".row").each(function(){$(this).find(".users_checkbox").is(":checked")==1&&users.push($(this).find(".users_login").text())}),users_selected_html="<ul>",$.each(users,function(a,b){users_selected_html+="<li>"+b+"</li>"}),users_selected_html+="</ul>",skel_dialog_title=gettext("Massive skeleton reapplying"),users_selected_html=="<ul></ul>"?(skel_dialog_content=gettext("Please select at least one user account."),skel_dialog=new dialog(skel_dialog_title,skel_dialog_content),skel_dialog.show()):(skel_dialog_content=gettext("Are you sure you want to reapply their skeleton to these user account(s):"),skel_dialog_content+=users_selected_html,$.get("/users/message/massive_skel/",function(a){skel_dialog_content+=a,skel_dialog=new dialog(skel_dialog_title,skel_dialog_content,!0,function(){users=[],$("#users_list").find(".row").each(function(){$(this).find(".users_checkbox").is(":checked")==1&&users.push($(this).find(".users_uidNumber").text())}),skel=$("#id_skel_to_apply").attr("value").toString(),page_url="/users/massive/skel/"+$.URLEncode(users.join(","))+"/"+$.URLEncode(skel),$.get(page_url)}),skel_dialog.show()}))}),$("#"+a+"_massive_permissiveness").click(function(){groups=[],$("#"+a+"_list").find(".row").each(function(){$(this).find(".groups_checkbox").is(":checked")==1&&groups.push($(this).find(".groups_name").text())}),groups_selected_html="<ul>",$.each(groups,function(a,b){groups_selected_html+="<li>"+b+"</li>"}),groups_selected_html+="</ul>",perm_dialog_title=gettext("Massive group premissiveness"),groups_selected_html=="<ul></ul>"?(perm_dialog_content=gettext("Please select at least one group."),perm_dialog=new dialog(perm_dialog_title,perm_dialog_content),perm_dialog.show()):(perm_dialog_content=gettext("Are you sure you want to toggle permissiveness of group(s):"),perm_dialog_content+=groups_selected_html,perm_dialog=new dialog(perm_dialog_title,perm_dialog_content,!0,function(){groups=[],$("#"+a+"_list").find(".row").each(function(){$(this).find(".groups_checkbox").is(":checked")==1&&groups.push($(this).find(".groups_gidNumber").text())}),page_url="/groups/massive/permissiveness/"+$.URLEncode(groups.join(",")),$.get(page_url)}),perm_dialog.show())}),$("#"+a+"_massive_select").click(function(){$(this).attr("checked")=="checked"?checked=!0:checked=!1,$("#"+a+"_list").find("."+a+"_checkbox").each(function(){!$(this).is(":disabled")&&$(this).is(":visible")&&$(this).attr("checked",checked)})}),setTimeout(function(){sort_items_list(a,"asc",b,d,!0),setTimeout(function(){window[a+"_init_row_events"]()},50)},50)}function delayed_sort(a,b,c,d){timeout=delayed_sort_timers[a],timeout&&clearTimeout(timeout),delayed_sort_timers[a]=setTimeout(function(){sort_items_list(a,b,c,d)},500)}function sort_items_list(a,b,c,d){body_wait(),$("#"+a+"_list").find(".current_sort").removeClass("current_sort"),$("#"+a+"_list").find(".header_"+c).addClass("current_sort"),cpt=0,hidden=0,d?users_list_return=$("#"+a+"_list").find(".row"):(users_list_return=my_sort(a,b,[c]),$.each(users_list_return,function(a,b){$(this).is(":hidden")&&(hidden+=1)})),effect_duration=75*(users_list_return.length-hidden),effect_duration==0&&(effect_duration=100),effect_duration>750&&(effect_duration=750),final_width=$("#"+a+"_list_header").width(),css_classes=Array({del_classes:a+"_row_odd row_odd odd",add_classes:a+"_row_even row_even even"},{add_classes:a+"_row_odd row_odd odd",del_classes:a+"_row_even row_even even"}),animate=users_list_return.length<max_items_animate,users_list_return.each(function(b,c){the_div=$(this).filter("."+a+"_row"),final_position=cpt*51+"px",final_position==the_div.css("margin-top")?the_div.css({"z-index":5e3}):the_div.css({"z-index":b}),animate?the_div.stop(!0,!0).animate({"margin-top":final_position},effect_duration*Math.random(),"swing").width(final_width):the_div.css("margin-top",final_position).width(final_width),the_div.is(":hidden")||(the_div.find(".odd_even_typed").each(function(){classes=css_classes[cpt%2],$(this).removeClass(classes.del_classes),$(this).addClass(classes.add_classes)}),cpt+=1)}),body_unwait()}function search(a,b,c,d){body_wait();var e=b.length;if(e==1)return;e==0&&(e=.86),effect_duration=650/e,b=no_accent(b.toLowerCase()),compt=0,items=$("#"+a+"_list").find("."+a+"_row"),animate=items.length<max_items_animate,items.each(function(){match=!1,the_div=$(this),$.each(c,function(c,d){if(b.length==0||no_accent(the_div.find("."+a+"_"+d).text().toLowerCase()).search(b)!=-1)return match=!0,!1}),compt%2!=0?(add_classes=["users_row_odd","row_odd","odd"],del_classes=["users_row_even","row_even","even"]):(del_classes=["users_row_odd","row_odd","odd"],add_classes=["users_row_even","row_even","even"]),match?(the_div.is(":hidden")?animate?the_div.stop(!0,!0).fadeIn(effect_duration).animate({"margin-top":compt*51+"px"},effect_duration*Math.random(),"swing"):the_div.show():animate?the_div.stop(!0,!0).animate({"margin-top":compt*51+"px"},effect_duration*Math.random(),"swing"):the_div.css("margin-top",compt*51+"px"),compt+=1,the_div.find(".odd_even_typed").each(function(){for(i=0;i<del_classes.length;i++)$(this).removeClass(del_classes[i]);for(i=0;i<add_classes.length;i++)$(this).addClass(add_classes[i])})):animate?the_div.stop(!0,!0).fadeOut(effect_duration):the_div.hide()}),body_unwait()}function my_sort(a,b,c){return items=$("#"+a+"_list").find(".row"),b=="asc"?items.sort(function(b,d){var e=$(b).find("."+a+"_"+c).html().toLowerCase(),f=$(d).find("."+a+"_"+c).html().toLowerCase();return Number(e)?e-f:e!=f?e<f?-1:1:0}):items.sort(function(b,d){var e=$(b).find("."+a+"_"+c).html().toLowerCase(),f=$(d).find("."+a+"_"+c).html().toLowerCase();return Number(e)?f-e:e!=f?e>f?-1:1:0}),items}function select_row(a,b){unselect_row(),div=$("#"+a+"_list").find(".row").filter("#"+b),div.addClass("item_selected"),div.children().addClass("bkg_selected"),div.find("."+a+"_content").children().addClass("bkg_selected"),div.find(".item_menu").show()}function unselect_row(){$(".item_selected").removeClass("item_selected"),$(".bkg_selected").removeClass("bkg_selected"),$(".item_menu").hide()}function add_row(a,b,c){list=$("#"+a+"_list"),typeof c=="undefined"?list.find(".list_items").append(b):list.find(c).after(b),list.hasClass("ajax-content-resizable")&&(content_width=list.find(".list_header").width(),list.find(".row").width(content_width)),list.hasClass("ajax-sortable")&&delayed_sort(a,list.find(".current_sort").attr("value"),list.find(".current_sort").attr("id"),!1)}function del_row(a,b){list=$("#"+a+"_list"),list.find("#"+b).filter("."+a+"_row").remove(),list.hasClass("ajax-sortable")&&delayed_sort(a,list.find(".current_sort").attr("value"),list.find(".current_sort").attr("id"),!1)}function update_row_value(a,b,c,d,e){the_span=$("#"+a+"_list").find("#"+b).filter("."+a+"_row").find("."+a+"_"+c),the_span.html(d);if(typeof e!="undefined")for(var f=0,g=e.length;f<g;f++)the_class=e[f],the_class[0]=="+"?the_span.addClass(the_class.slice(1)):the_span.removeClass(the_class.slice(1))}function change_locked_state(a,b,c){user_locked=$("#users_list").find("#"+b).filter(".users_row").find(".users_locked"),user_locked.html(generate_locked_img("out",c)),c?user_locked.addClass("is_locked"):user_locked.removeClass("is_locked")}function change_permissive_state(a,b){g_perm=$("#groups_list").find("#"+a).filter(".groups_row").find(".groups_permissive"),g_perm.html(generate_permissive_img("out",b)),b?g_perm.addClass("is_permissive"):g_perm.removeClass("is_permissive")}function update_relationship(a,b,c,d){typeof d=="number"?new_rel=relationships[d]:new_rel=d,a=$("#click_item_id").text(),a=="user"?item_id=b:item_id=c,div=$("#sub_content").find("#"+item_id).filter(".click_item"),popover=$(".popover_item").filter("#"+item_id).parent(),hidden_input=div.find('input[name$="'+new_rel+"_"+a+'s"]'),popover.children().show(),popover.find(".rel_"+new_rel).hide(),div.attr("value",new_rel),div.find(".item_hidden_input").attr("value",""),hidden_input.attr("value",item_id),div.find(".item_title").removeClass("no_membership_bkg guest_bkg member_bkg resp_bkg").addClass(new_rel+"_bkg")}order_pic=[],order_pic.asc='<img src="/media/images/12x12/sort_asc.png" alt="asc order image">',order_pic.desc='<img src="/media/images/12x12/sort_desc.png" alt="desc order image">';var max_items_animate=100,list_hover_timeout_value=250,hover_timeout=null,delayed_sort_timers={},search_timer=null;relationships=["no_membership","guest","member","resp"];