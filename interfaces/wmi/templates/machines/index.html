{#- Copyright 2012 META IT & Robin Lucbernet<robin@meta-it.fr>
    Distributed under the terms of the GNU GPL version 2. -#}

{%- extends 'list.html' -%}

{%- block title -%}
	{{ _('Machines management') }}
{%- endblock -%}


{%- block list_title -%}
	{{ _('Machines') }} (<span id='model_machines_count'></span><span id="model_machines_total" style="font-size:18px;">/{{ machines|length }}</span>)
{%- endblock -%}

{%- block massive_actions -%}
	<div class="btn-group">
		<button class="btn massive_action" data-url='/machines/massive/upgrade/' id="massive_upgrade" data-name='upgrade'>{{_('Upgrade')}}</button>
		<button class="btn massive_action" data-url='/machines/massive/shutdown/' id="massive_shutdown" data-name='shutdown'>{{_('Shutdown')}}</button>
		<!--<button class="btn">2</button>-->
	</div>
{%- endblock -%}

{%- block list_filters -%}
	<!-- 
	<span class="btn-group" data-toggle="buttons-checkbox">
		<button id='filter_server' class="btn filter_item" data-filter='server'>
			<i class="icon-map-marker" title="{{ _('Servers') }}"></i>
		</button>
		<button id='filter_client' class="btn filter_item" data-filter='client'>
			<i class="icon-wrench" title="{{ _('Client') }}"></i>
		</button>
		<button id='filter_licorn' class="btn filter_item" data-filter='licorn'>
			<i class="icon-warning-sign" title="{{ _('Licorn machines (clients and servers)') }}"></i>
		</button>
		<button id='filter_other' class="btn filter_item" data-filter='other'>
			<i class="icon-map-marker" title="{{ _('Other') }}"></i>
		</button>
	</span>
	-->
{%- endblock -%}

{%- block list_headers -%}
	<th class='table_column_header centered' style="width: 7%">{{ _('Type') }}</th>
	<th class='table_column_header centered' style="width: 5%">{{ _('Status') }}</th>
	<th class='table_column_header' style="width: 75%">{{ _('Hostname') }}</th>
	<th class='table_column_header centered' style="width: 5%">{{ _('Backend') }}</th>
	<th class='table_column_header centered' style="width: 5%" title="{{ _('Operating System') }}">{{ _('OS') }}</th>
{%- endblock -%}

{%- block list_body -%}
	{%- for machine in machines -%}
		{%- include 'machines/machine_row.html' -%}
	{%- endfor -%}

	<script language="javascript" type="text/javascript">

		$(document).ready(function() {

			// setup the list
			var START_TIME = new Date().getTime();

			setup_list('machines');

			setup_upgrade_facilities()

			var END_TIME = new Date().getTime();
			totalTime = (END_TIME - START_TIME);
			console.log("total time to setup machines list", totalTime);
		});

		function func_doubleclick_row(td) {
			// what happens when a row has been double clicked,
			// show the edit form.

			if (! $(td).hasClass('no_double_click')) {

				mid = td.data('id')

				if (mid == null) {
					mid = td.parent('.licorn_row').data('id')
				}

				$.get('/machines/edit/'+mid, function(modal_html) {
					$("#modal").html(modal_html).modal()
				})
			}
		}

		function get_list_column() {
			return ["String", "String", "String", "String", "String"]
		}

		// filters used to filter the table
		var filters = { 'other' : true }

		function setup_upgrade_facilities(selector) {
			if (selector == null) {
				selector = $(".machine_upgrade")
			}
			selector.click(function() {
				mid = $(this).data('mid')
				$.get('/machines/upgrade/'+mid)
			})
		}
	</script>
{%- endblock -%}





