{#- Copyright 2012 META IT & Robin Lucbernet<robin@meta-it.fr>
    Distributed under the terms of the GNU GPL version 2. -#}

{%- extends 'list.html' -%}

{%- block title -%}
	{{ _('Groups management') }}
{%- endblock -%}


{%- block list_title -%}
	{{ _('Groups') }} (<span id='model_groups_count'></span><span id="model_groups_total" style="font-size:18px;">/{{ groups|length }}</span>)
{%- endblock -%}

{%- block massive_actions -%}

	<span class="btn-group">
		<button class="btn massive_action" data-url='/groups/massive/delete/' title="{{ _('Massively delete selected groups.') }}"  data-name='delete' id="massive_delete">
			<img src="/media/images/14x14/mass_del.png" alt="massive delete icon"/>
		</button>
		<button class="btn massive_action" data-url='/groups/massive/permissivness/' data-name='permissive' id="massive_permissive" title="{{ _('Massively make/unmake selected groups permissive.') }}" >
			<img src="/media/images/14x14/mass_lock.png" alt="massive permissive icon"/>
		</button>
		<button class="btn massive_action" data-url='/groups/massive/export/' data-name='export' id="massive_export" title="{{ _('Massively export seleted groups.') }}" >
			<img src="/media/images/14x14/mass_export.png" alt="massive export icon"/>
		</button>
		<button class="btn massive_action" data-url='/groups/massive/apply_skel/' data-name='skel' id="massive_skel" title="{{ _('Massively reapply groups\' skel on groups\' members.') }}">
			<img src="/media/images/14x14/mass_skel.png" alt="massive apply skel icon"/>
		</button>
		<button class="btn massive_action" data-url='/groups/massive/edit/' data-name='edit' id="massive_edit" title="{{ _('Massively edit groups.') }}">
			<img src="/media/images/14x14/mass_group.png" alt="massive edit groups icon"/>
		</button>
	</span>

{%- endblock -%}

{%- block list_filters -%}




	<span class="btn-group" data-toggle="buttons-checkbox">
		{% if request.user.is_superuser %}
			<button id='filter_standart' class="btn filter_item" data-filter='standard'>
				<i class="icon-map-marker" title="{{ _('Standard') }}"></i>
			</button>
			<button id='filter_privileged' class="btn filter_item" data-filter='privileged'>
				<i class="icon-glass"></i>
			</button>
			<button id='filter_system' class="btn filter_item" data-filter='system'>
				<i class="icon-wrench" title="{{ _('Systems') }}"></i>
			</button>
			<button id='filter_restricted' class="btn filter_item" data-filter='restricted'>
				<i class="icon-warning-sign" title="{{ _('Restricted') }}"></i>
			</button>
		{% elif request.user.is_staff %}
			<button id='filter_standart' class="btn filter_item" data-filter='standard'>
				<i class="icon-map-marker" title="{{ _('Standard') }}"></i>
			</button>
			<button id='filter_privileged' class="btn filter_item" data-filter='privileged'>
				<i class="icon-glass" title="{{ _('Privileged') }}"></i>
			</button>
		{% endif %}

	</span>
{%- endblock -%}

{%- block list_headers -%}
	<th class='table_column_header centered' width="7%">{{ _('Type') }}</th>
	<th class='table_column_header centered' width="7%">{{ _('Permissive') }}</th>
	<th class='table_column_header'          width="12%">{{ _('Name') }}</th>
	<th class='table_column_header'          width="50%">{{ _('Description') }}</th>
	<th class='table_column_header centered' width="7%" title="{{ _('Group identifier') }}">{{ _('Gid') }}</th>
	<th class='table_column_header centered' width="7%">{{ _('Backend') }}</th>
	<th class='table_column_header centered' width="12%">{{ _('Skel') }}</th>
{%- endblock -%}

{%- block list_body -%}
	{%- for group in groups -%}
		{%- include 'groups/group_row.html' -%}
	{%- endfor -%}


	<script language="javascript" type="text/javascript">

		$(document).ready(function() {

			// setup the list
			var START_TIME = new Date().getTime();

			setup_list('groups');

			var END_TIME = new Date().getTime();
			totalTime = (END_TIME - START_TIME);
			console.log("total time to setup user list", totalTime);
		});

		function func_doubleclick_row(td) {
			// what happens when a row has been double clicked,
			// show the edit form.

			if (! $(td).hasClass('no_double_click')) {

				gid = td.data('id')

				if (gid == null) {
					gid = td.parent('.licorn_row').data('id')
				}

				$.get('/groups/edit/'+gid, function(modal_html) {
					$("#modal").html(modal_html).modal()
				})
			}
		}

		function get_list_column() {
			return ["String", "String", "String", "String", "Number", "String", "String"]
		}

		// filters used to filter the table
		var filters = { 'standard' : true, 'system': true, 'restricted': false, 'privileged': true}
		

	</script>
{%- endblock -%}



