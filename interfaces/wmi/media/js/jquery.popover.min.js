(function(a){a.fn.popover=function(b){function k(){if(a.fn.popover.openedPopup!=null)a.fn.popover.openedPopup.trigger("hidePopover")}function j(b){b.removeClass("popover-on");a(document).trigger("popoverClosed");d.popover$.removeClass("active").attr("style","").hide();if(a.isFunction(d.closeEvent)){d.closeEvent(b)}a.fn.popover.openedPopup=null}function i(b,c){if(a.fn.popover.openedPopup&&a.fn.popover.openedPopup.get(0)===b.get(0)){if(!c)k();return}k();d.triangle$.click(function(){b.trigger("hidePopover")});d.triangle$.attr("style","");h(g(b));setTimeout(function(){d.popover$.addClass("active")},0);if(a.isFunction(d.openEvent)){d.openEvent(b)}a.fn.popover.openedPopup=b;b.addClass("popover-on");a(document).trigger("popoverOpened")}function h(a){d.triangle$.removeClass("left top right bottom");d.triangle$.addClass(a.popoverDir);if(a.triangleX>0){d.triangle$.css("left",a.triangleX)}if(a.triangleY>0){d.triangle$.css("top",a.triangleY)}d.popover$.offset({top:a.popoverY-a.deltaY+d.offsetY,left:a.popoverX-a.deltaX+d.offsetX});d.popover$.css("z-index",d.zindex).show()}function g(b){d.popover$.css("display","block");var c={popoverDir:"bottom",popoverX:0,popoverY:0,deltaX:0,deltaY:0,triangleX:0,triangleY:0,triangleSize:20,docWidth:a(window).width(),docHeight:a(window).height(),popoverWidth:d.popover$.outerWidth(),popoverHeight:d.popover$.outerHeight(),buttonWidth:b.outerWidth(),buttonHeight:b.outerHeight(),buttonOffset:b.offset()};var g=e(b,c);c.popoverDir=f(g);if(c.popoverDir=="bottom")c.popoverY=c.buttonOffset.top+c.buttonHeight+c.triangleSize;else if(c.popoverDir=="top")c.popoverY=c.buttonOffset.top-c.triangleSize-c.popoverHeight;else c.popoverY=c.buttonOffset.top+(c.buttonHeight-c.popoverHeight)/2;if(c.popoverDir=="bottom"||c.popoverDir=="top"){c.popoverX=c.buttonOffset.left+(c.buttonWidth-c.popoverWidth)/2;if(c.popoverX<d.padding){c.deltaX=c.popoverX-d.padding}else if(c.popoverX+c.popoverWidth>c.docWidth-d.padding){c.deltaX=c.popoverX+c.popoverWidth-c.docWidth+d.padding}c.triangleX=c.popoverWidth/2-c.triangleSize+c.deltaX;c.triangleY=0}else{if(c.popoverDir=="right")c.popoverX=c.buttonOffset.left+c.buttonWidth+c.triangleSize;else c.popoverX=c.buttonOffset.left-c.triangleSize-c.popoverWidth;if(c.popoverY<d.padding){c.deltaY=c.popoverY-d.padding}else if(c.popoverY+c.popoverHeight>c.docHeight-d.padding){c.deltaY=c.popoverY+c.popoverHeight-c.docHeight+d.padding}c.triangleX=0;c.triangleY=c.popoverHeight/2-c.triangleSize+c.deltaY}return c}function f(a){if(d.preventBottom)a.bottom=false;if(d.preventTop)a.top=false;if(d.preventLeft)a.left=false;if(d.preventRight)a.right=false;var b="right";if(d.preventRight)b="bottom";if(d.preventBottom)b="top";if(d.preventTop)b="left";if(a.right)b="right";else if(a.bottom)b="bottom";else if(a.left)b="left";else if(a.top)b="top";return b}function e(a,b){var c={left:false,right:false,top:false,bottom:false};if(b.buttonOffset.top+b.buttonHeight+b.triangleSize+b.popoverHeight<=b.docHeight-d.padding){c.bottom=true}if(b.buttonOffset.top-b.triangleSize-b.popoverHeight>=d.padding){c.top=true}if(b.buttonOffset.left+b.buttonWidth+b.triangleSize+b.popoverWidth<=b.docWidth-d.padding){c.right=true}if(b.buttonOffset.left-b.triangleSize-b.popoverWidth>=d.padding){c.left=true}return c}var c=27;var d=a.extend({id:"",openEvent:null,closeEvent:null,offsetX:0,offsetY:0,zindex:1e5,padding:18,closeOnEsc:true,preventLeft:true,preventRight:true,preventTop:false,preventBottom:true,live:false},b||{});d.popover$=a('<div class="popover" id="'+d.id+'">'+'<div class="triangle"></div>'+'<div class="content"></div>'+"</div>").appendTo("body");a(".content",d.popover$).append(a(d.content).detach());d.triangle$=a(".triangle",d.popover$);a.fn.popover.openedPopup=null;a(document).unbind(".popover");a(document).bind("click.popover",function(b){if(a(b.target).parents(".popover").length==0&&!a(b.target).hasClass("popover-button")){k()}});a(document).bind("hideOpenPopover.popover",k);var l=this;if(d.closeOnEsc){a(document).bind("keydown",function(a){if(!a.altKey&&!a.ctrlKey&&!a.shiftKey&&a.keyCode==c){l.trigger("hidePopover")}})}if(!d.live){return this.each(function(){var b=a(this);b.addClass("popover-button");b.bind("click",function(){i(b);return false});b.bind("showPopover",function(){i(b,true);return false});b.bind("hidePopover",function(){j(b);return false})})}else{this.live("click",function(b){a(b.target).addClass("popover-button");i(a(b.target));return false});this.live("showPopover",function(b){a(b.target).addClass("popover-button");i(a(b.target),true);return false});this.live("hidePopover",function(b){j(a(b.target));return false});return this}}})(jQuery)
