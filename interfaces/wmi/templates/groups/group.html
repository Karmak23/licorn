


{%- extends 'modal.html' -%}

    {%- block title -%}
	    {%- if mode == 'new' -%}
	    	<h3>{{ _('New group') }}</h3>
	    {%- elif mode == 'edit' -%}
	    	<h3>{{ _('Edit group') }} {{ '<span id="machine_hostname_{1}">{0}</span>'.format(group.name, group.gid) }}</h3>
	    {%- elif mode == 'massiv' -%}
	    	<h3>{{ _('Massive group edition') }}</h3>
	    {%- endif -%}
    {%- endblock -%}


  {%- block body -%}

  	{% if form.errors and not form.non_field_errors() -%}
	    <div class="error_div error_text">
			{% trans count=form.errors.items()|length() %}
			    Merci de corriger l'erreur ci-dessous&nbsp;:
			{% pluralize %}
			    Merci de corriger les erreurs suivantes&nbsp;:
			{% endtrans %}
	    </div>
	{% endif -%}

	{% if form.non_field_errors() %}
	    {% for error in form.non_field_errors() %}
			<p class="errornote">
				{{ error }}
			</p>
	    {% endfor %}
	{% endif %}

	<form class="form-horizontal" id='user_form'>{% csrf_token %}




	<ul class="nav nav-tabs" id="myTab">
		{% for block in form_blocks %}
			<li {{ 'class="active"' if form_blocks[block][2] }}><a href="#{{ form_blocks[block][0] }}" data-toggle="tab">{{ form_blocks[block][1] }}</a></li>
		{% endfor %}
	</ul>
	<div class="tab-content">


	<div class="tab-pane active" id="general">

		<div class="control-group">
			{% for field in form.visible_fields() %}
			<div style="min-height:50px;">
				<label class="control-label" for="id_{{ field.name }}">
					{{ field.label }}
					{%-if field.field.required -%}
						&nbsp;
						<span class="required_field">*</span>
					{%- endif -%}
				</label>
				<div class="controls" style="vertical-align:center;">
					{{ field }}

					{%-if field.field.help_text -%}
						<p class="help-block">{{ field.field.help_text }}</p>
					{%- endif -%}
				</div>
			</div>
			{% endfor %}
		</div>
	</div>
	
		
	{# add users and sys_user pane #}


	{%- for title, users_list in users_lists -%}
		<div class="tab-pane" id="{{ users_list.name }}">
    	
			<div>
				{%- include 'groups/users_list.html' -%}
			</div>
		


    	</div>
    	

	{%- endfor -%}


	</div> <!-- end tab-content -->
	



	</form>


  {%- endblock -%}
  {%- block footer -%}
  	<a href="#" class="btn" data-dismiss="modal">{{ _('Fermer') }}</a>
    {% if mode == "new" %}
    <a href="#" class="btn btn-primary" id="save_user_button">{{ _('Add user') }}</a>
    {%endif%}



    <script type="text/javascript">
	$(document).ready(function() {
		
		// .click_item are our user box, when click is triggered, 
		// show the popover containing possible relationship
		$('.click_item').each(function() {
			// display only relevant groups
			rel = $(this).attr('value');
			$(this).find('.rel_'+rel).hide();
			
			// initialize the popover
			$(this).popover({
				content: $(this).find('.user_popover_content'), 
				position: 'top',
			}).click(function() {
					// on popover display, initialize instant_click, if 'edit' or 'massiv' mode
					{% if mode == 'edit' or mode == 'massiv' %}
						init_instant_click($('#user_popover_'+$(this).attr('id')))
					{% endif -%}
				});
			
		});


		{%- if mode == 'new' -%}
			
			function post_form() {
				$.post("/groups/create/", $('#user_form').serialize());
			}

			$(document).keyup(function(e) {
				if (e.keyCode == 13) { // enter
					post_form();
				}
			});


			// click save button
			$('#save_user_button').click( function() {
				post_form();
			});
			$('#modal').modal('hide')

			
		{%- endif -%}

	$('#id_permissive').checkbox({
        'on_text': "{{ _('No') }}",
        'off_text' : "{{ _('Yes') }}"
    })



	});
</script>



    
  {%- endblock -%}










