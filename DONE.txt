
 Things Done
 ~~~~~~~~~~~

 - [OK] [BUG #687] R lors de l'ajout d'un utilisateur, son profile est "No profile" dans la liste quand il apparaît, alors que si on reload la page il est bien "Users".
	> auto-resolved by the re-import of the WMI in the daemon.

 - [OK] backport the / user view (no admins/licorn-wmi).

 - [OK] Damn bootstrap circular loops:
	* devinstall will install missing packages before installation
	* but `make devinstall` uses `foundations.bootstrap` to determine the install $CWD,
	* if some packages are missing, this fails.
	* then devinstall fails in turn...

 - [OK] les commandes rdiffbackup semblent ne pas s'exécuter avec `ionice` (pourtant le `nice` est bon dans `top`).
	> vérifié visuellement, elle le font. Corrigé le [ '-c', '3' ] en [ '-c3' ] au cas où car c'est comme ça que je l'utilise en CLI.

 - [OK] quand licornd et la WMI sont lancés séparément, un licornd -K ne tue que licornd.
	> résolu avec un temps d'attente, le licornd tuait l'instance "juste-forkée" lancée pour tuer la WMI (trop rapide, Luke !!).
 - [OK] quand licornd -rvD, licornd meurt au moment où la WMI est lancée (sans message)
	> la WMI est systématiquement lancée en --daemon, via os.system(), c'est bien plus simple. Si l'on veut son terminal, il faudra la lancer à partir d'un autre TTY. C'est moins confort mais plus logique (2 apps sur le même TTY, qui reçoit le Control-C ?? qui contrôle le TTY ??)
 - [OK] quand licornd -rvvv, on a :
	> start licornd #1
	> fork WMI #1
	> licornd #1 crash
	> licornd #2 forké par WMI #1
	> WMI#1 crash
	> WMI #2 forkée par licornd #2
	> tout est OK, mais il y a eu des crashs et les daemons ont forké 2 fois.
	> on a deux fois "fork #1" dans les logs, alors que la trace de daemonize()
		ne donne qu'un seul appel à la fonction en questions.
	> résolu par l'appel à os.system() plutôt que la mécanique compliquée de forks() qui plantait parce qu'on était pas dans MainThread de toute manière. Plus aucun process zombie. Ç a l'air bien plus robuste en l'état.

 - [OK] ERROR: [2012/19/02 10:14:12.9163] termios.error: (5, 'Input/output error').
 	- quand on redémarre le daemon et que la WMI est attachée à un autre terminal.
 	> fixé dans une correction recente de ttyutils + interacteurs

 - [OK] convertir User/Group/Machine/Profile à _lpickle_
	> non vérifié mais récemment users/groups/profiles passent sans souci dans le tunnel Pyro. Seules les machines pourraient poser problème, et nous repasserons dessus pour la v1.4.

 - [WORKS_FOR_ME] pas de load_avg SVG sur Squeeze. Je n'arrive pas à le reproduire, ça ne s'est produit que pendant une courte période. Actuellement c'est OK sur ma squeeze.

 - [OK] des fois, la WMI ne reçoit plus d'évènements du daemon (il faut redémarrer le daemon).
 	> corrigé 1 bug de resynchro sur process.pidof(), mais à priori ce n'était pas ça la cause.
	> problème de synchro gevent / pyro, incompat bas-niveau entre os.fork(), les threads et les greenlets. Gevent remplacé par Twisted et le problème n'est pas réapparu.

 - [OK] big compatibility and simplification of extensions / backends (no more _available_modules in ModulesManager, etc).
	> review it's finalized.
	> OK in core.*, but not completely implemented in extensions (caldavd needs refreshing but this won't hurt anyone as it is, we just need to reload the daemon on change).

 - [OK] modules: `extensions.squid.ignore` n'a plus d'effet
	> le ModulesManager cherchait le '.ignore' dans `LMC.configuration` au lieu de `settings`.
 - [OK] make extensions be picklable (with the same conditions than core objets, ie. not beiing fully transposed to remote side, but fully usable via WmiProxy), merge all special threads, locks and events into the extensions standard ones.

 - [DONE] R le classement par état / type / OS ne marche pas pour les machines

 - [DONE] R le search_field (users/groups) est sensible aux accents (il faut "tè" pour "Olivier Cortès")

 - [DONE] *edit* user -> sub-content -> delete -> sub_content toujours là.

 - [DONE] R massive_skel non implémenté

 - [DONE] R user::add::nom seul > créer avec login == validate_*(gecos)
 	> comme dans la CLI add user --gecos "toto content" > user totcontent créé

 - [DONE] R sur un multi-del user/group, le compteur du titre passe à opacity:0. PB de stop(true, true)

 - [OK] SSL-only support in the WMI HTTP/WSGI server.

 - [OK] "Enter" dans "Add" créée le groupe/user

 - [OK] le nombre d'utilisateurs et de groupes (total près du titre) n'est pas mis à jour (n'importe quelle opération).
 	> correction > event_handlers > maj SPAN

 - [OK] upgrades :
 	> [OK] dans le module en lui-même, faire le symlink dans le bon répertoire, ou alors try/except
 	> [pas comme ça] ou alors dans le Makefile, sur les targets `build` et `devinstall`

 - [OK] la case "tout cocher" coche même les lignes qui ne sont pas visibles
 	> testé sur les utilisateurs et les groupes, utilise .is(':visible')

 - [OK] Debian Squeeze :
 	- [OK] sur DEBIAN, pas d'upstart > ServiceExtension plante sur SSH par exemple
 	- [OK] dbus n'est pas détecté alors qu'il est présent (udisks aussi)

 - [OK] vérifier l'appel possible de l'accesskey F pour le search_field des licorn_list (ça ne marche pas dans chromium).
 	> on s'en fout un peu, avec [ESC] on revient toujours au `search_field`

 - [OK] quelques traductions -> django-admin compilemessages -l fr -> modifié Makefile pour supprimer la gestion des JS

 - [OK] tester les `upgrades` de django/djinja/jinja2 dans une VM dédiée.

 - [OK] samba3: visiblement pas d'ajout, et problème à la suppression (en shadow)
 	> ajout OK (test avec smbclient //localhost/homes -Utoto pour vérifier)
 	> suppression OK et messages bénins (cf. FAQ extension)
 	> modif password OK

 - [OK] `upgrades` : premier lancement de la WMI:
	 - intégrer le syncdb initial dans le boot de la WMI + mkdirs settings.DB['default']
	 - autoinstall Jinja2
	 - autoinstall Djinja via pip + chmod

 - [OK] implémenter le target = _blank dans le JS qui "bouffe" les liens du sidebar. C'est OK dans macro::menu_item() mais ça ne suffit pas.
 	> ne fait pas tout le JS si un target est SET.

 - [OK] preload images (throbber)
	http://binarykitten.me.uk/dev/jq-plugins/107-jquery-image-preloader-plus-callbacks.html
	http://engineeredweb.com/blog/09/12/preloading-images-jquery-and-javascript

 - [OK] multiple-ESC revient toujours à la liste, avec #search_box focus.

 - [OK] Click sur user/group > subcontent OK > ESC pour disparaître > "l'utilisateur machin est maintenant connu sous le nom de ..." (idem groups)
 	> faire une fonction de vérif en JS pour ne pas envoyer les valeurs si elles ne changent pas.
 	> NON, il suffit de péter les timeout de l'instant apply

 - [OK] retester enter / esc sur les dialog (avec Robin dans le train)

 - connection lost chez Robin
 	> ne se produit plus sur un repo propre.

 - [OK] double-action quand sur éteindre / redémarrer
 	> double setup des liens dans menu.js

 - [OK] remettre le slide-left-right sur le menu de gauche (sidebar).
 	> background-position ne prend plus de strings mais que des entiers depuis jQuery 1.5+, et nous avons migré vers 1.7 pendant le dév de la WMI2.

 - le CSS du groupe / user se vide après clic dans popover -> unicode(a) dans utils.format_rpc_js()
 	 > (même cause) perm/unperm de groupe est bloqué un coup sur deux (comme avant).

 - [OK, autre problème à régler maintenant] trouver la bonne manière de faire le gettext côté python dans la WMI2. c'est OK dans les templates HTML (domaine django), mais les views utilisent le _ du daemon (domaine licorn). soit on merge, soit on enlève _ des builtins dans la WMI. savoir pourquoi l'un plutôt que l'autre.

 - [OK] pourquoi l'import ne rafraichit pas la liste au fûr et à mesure ?
	- mauvaise implémentation, l'appel à RWI.import... est synchrone, alors qu'il devrait passer par enqueue_operation() et que l'import devrait emettre des évènements users_import_started & users_import_finished (avec le lien vers le fichier HTML à mettre dans le reload_div()).

 - [OK] dans les user::views, mettre les groupes "standard" des resp / guests (pas les gst-* / rsp-*)

 - [OK] dans la edit-view, le profile affiche 100, et pas "Utilisateur".

 - [OK] dans la view::hover des users, le profil n'est pas affiché, ni le groupe primaire ;

 - [OK] group -> permissive -> rien de visuel, mais l'action est OK.
	- dans le edit, pas de souci
	- si déjà perm: no-perm OK, perm-does-nothing

 - [OK] le click d'un user/group dans les "views" de user/group affiche bien le user, mais la liste à gauche est vide (c'est OK pour les groupes).

 - [OK] amélioration visuelle des dialog massive.

 - [OK] dans le titre, c'est "LOGIN" et non {{user.login}}.

 - [OK] la WMI ne démarre pas si lancée via le `licornd` master, mais elle démarre bien à la main.

 - [OK] amélioration des "views" hover users/groups.

 - [OK] finir le nettoyage de daemon_status() (CLI plante, et WMI incomplète)

 - [OK] clean PYRO:
	- [OK] migrer system.*_monitor() et system.console_*() dans le listener object, pour pouvoir ouvrir une console sur un client_daemon aussi (pas seulement un serveur)
	- [OK] migrer system.*_monitor() et system.console_*() dans la RWI
	- [OK] CLI ne se connecte qu'à RWI
	- [OK] LMC.configuration doit devenir RWI.configuration_get(...) partout dans CLI/WMI
	- [OK] LMC.connect() ne se connecte plus qu'à RWI (pas system, ni configuration)

	 - [vérifié, il y a aussi le `get *` vers un client] seules Machines utilisent Pyro::system ?
	 - [OK] noop() dans RWI et system
	 - [OK] licornd_auth.py -> use RWI et pas system

 - [OK] multiples handlers with same name in different parts of WMI.

 - [NON] rétablir les liens automatiquement ?
 - [OK] lancer les méthodes via proxy
	- [OK] proxy via PYRO generic RPC

 - [OK] Rendre les LMC.connect() / release() stackables, pour en faire une connexion pseudo-persistante:
	- les appels multiples à connect() ne font rien, et seul le dernier release() le fait vraiment.

 - [OK, SelectableController] enable volume -> needs 'volumes' in LMC controllers
 - [OK] virer Pyro.core.objBase des controllers
 - [OK] mettre tous les controllers en self.__class__.instances -> insérer dans RWI.select()

 - [OK] en cours de __setstate__ dans foundations.classes
	- [OK] puis _modules
	- [OK] puis volumes
	- [OK] puis conversion core.*

 - [OK] faire quelque chose en cas de déconnexion de la WMI (mettre les graphes à zéro en rouge, avec un message qq part)
 	> message de gestion de la connexion push en JS

# `foundations.events`

- [OK] vérif events.dump_status CLI

- [OK] modif eventmanager dans le daemon
- [OK] renommer tous les _callback en @events.handler

- [OK] from licorn.daemon import workers > from licorn.foundations.workers import workers
	[OK] > workers.*_enqueue
	> workers.*_wait

- [OK] changer *collector dans core.system / RWI ?

- regexxer
	[OK] from licorn.daemon.base import InternalEvent > from licorn.foundations.events import LicornEvent
	[OK] InternalEvent(...) > LicornEvent(...)

- [OK] maj daemon status WMI

- [OK] vérif callbacks dans core.configuration
- [OK] idem dans LMC.*() qui faisait un collect() pour tout parcourir
