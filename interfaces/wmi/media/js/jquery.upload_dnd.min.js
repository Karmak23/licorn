function drag_enter(a){settings=a.data.settings,target=$(a.data.drag_target),num_drag_event++,target.addClass("upload-area-hover"),stop_event(a)}function drag_leave(a){settings=a.data.settings,target=$(a.data.drag_target),num_drag_event--,num_drag_event==0&&target.removeClass("upload-area-hover"),stop_event(a)}function drop(a){stop_event(a),settings=a.data.settings;var b=a.dataTransfer.files;stop_event(a),$(a.data.drag_target).trigger("dragleave"),settings.run_function!=null?settings.run_function(b,settings):do_upload(b,settings)}function do_upload(a,b){$.each(a,function(a,c){if($("#upload_recap")!=[]){var f=$(b.recap_line);$(f).find("#recap_file_name").html(c.name),$(f).find("#recap_file_size").html(getReadableFileSizeString(c.size)),$(f).addClass("upload-result"),$("#upload_recap").append(f)}var g=$('<center><img src="'+b.error_image_url+'"><center>'),h=!0;c.type==""?(f.find("#recap_file_progress").html("").append(g.attr("title","Unknown file type")),f.addClass("upload-result-error"),h=!1):b.file_size_max!=null&&c.size>b.file_size_max&&(f.find("#recap_file_progress").html("").append(g.attr("title","File too big, maximun allowed "+getReadableFileSizeString(b.file_size_max))),f.addClass("upload-result-error"),h=!1);if(h){var i=jQuery.ajaxSettings.xhr();i.upload&&i.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=Math.round(a.loaded*100/a.total);f.find("#recap_file_progress").html('<div class="progress progress-striped" style="display:\'inline\'"> <div class="bar" style="width: '+b+'%;">'+b+"%</div></div>"),f.addClass("upload-result-success"),setTimeout(function(){f.slideUp("slow",function(){$(this).remove()})},5e3)}stop_event(a)},!1),i.upload.addEventListener("load",function(a){stop_event(a)},!1),i.upload.addEventListener("error",function(a){stop_event(a)},!1),i.upload.addEventListener("abort",function(){stop_event(e)},!1),provider=function(){return i};var j={};$('input[name$="csrfmiddlewaretoken"]')!=null&&(j={csrfmiddlewaretoken:$('input[name$="csrfmiddlewaretoken"]').attr("value")});var k=$.extend({file:c},j);d=new FormData,$.map(k,function(a,b){d.append(b,a)}),$.ajax({url:b.upload_action_url,type:"POST",data:d,async:!0,xhr:provider,processData:!1,contentType:!1,success:function(a){b.success_handler(a)},error:function(a){f.find("#recap_file_progress").html("").append(g.attr("title",a.statusText)),f.addClass("upload-result-error"),b.error_handler!=null&&b.error_handler()}})}})}function stop_event(a){return a.stopPropagation(),a.preventDefault(),!1}function getReadableFileSizeString(a){var b=-1,c=[" kB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"];do a/=1024,b++;while(a>1024);return Math.max(a,.1).toFixed(1)+c[b]}$(document).ready(function(){$.event.props.push("dataTransfer")}),function(a){a.fn.upload_dnd=function(b){var c=a.extend({upload_action_url:"/",pre_function:null,error_hanlder:null,success_hanlder:null,recap_line:'<div><span id="recap_file_name"></span><span id="recap_file_size"></span><span id="recap_file_progress"></span></div>',error_image_url:"/media/images/16x16/emblem-important.png",file_size_max:null},b);return this.each(function(){a(this).bind("drop",{settings:c,drag_target:this},drop),a(this).bind("dragover",stop_event),a(this).bind("dragenter",{settings:c,drag_target:this},drag_enter),a(this).bind("dragleave",{settings:c,drag_target:this},drag_leave),a(this).addClass("upload-area"),a("#classic_upload")!=[]&&a("#classic_upload").change(function(a){var b=a.target.files;c.run_function!=null?c.run_function(b,c):do_upload(b,c)})})}}(jQuery);var num_drag_event=0;